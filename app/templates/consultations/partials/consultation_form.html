<div class="card shadow-sm border-0 animate-fade-in">
    <div class="card-header bg-primary text-white py-3 d-flex justify-content-between align-items-center">
        <div>
            <h2 class="h5 fw-bold mb-0">
                <i class="bi bi-file-earmark-medical me-2"></i>Atendimento: {{ appointment.patient.name }}
            </h2>
            <small class="opacity-75">Iniciado às {{ now.strftime('%H:%M') }}</small>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-sm btn-light text-primary fw-bold d-flex align-items-center gap-1" onclick="window.print()">
                <i class="bi bi-printer"></i> Imprimir
            </button>
        </div>
    </div>

    <div class="card-body p-4">
        {% if erro %}
        <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <div>{{ erro }}</div>
        </div>
        {% endif %}

        <form hx-post="/consultations/save/{{ appointment.id }}" hx-target="#main-content">
            <div class="row g-4">
                
                <div class="col-12">
                    <label class="form-label fw-bold small text-secondary text-uppercase tracking-wider">
                        <i class="bi bi-chat-left-dots me-1"></i>Queixa Principal
                    </label>
                    <textarea name="chief_complaint" class="form-control shadow-none border-secondary-subtle" 
                              rows="2" placeholder="O que o paciente relata como motivo da visita..." required></textarea>
                </div>

                <div class="col-12">
                    <label class="form-label fw-bold small text-secondary text-uppercase tracking-wider">
                        <i class="bi bi-clipboard-pulse me-1"></i>Exame Físico
                    </label>
                    <textarea name="physical_exam" class="form-control shadow-none border-secondary-subtle" 
                              rows="3" placeholder="Sinais vitais, palpação, ausculta, etc..."></textarea>
                </div>

                <div class="col-md-3">
                    <label class="form-label fw-bold small text-secondary text-uppercase tracking-wider">CID-10</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light"><i class="bi bi-search"></i></span>
                        <input type="text" name="cid_code" class="form-control shadow-none border-secondary-subtle" 
                               placeholder="Ex: J11" maxlength="10">
                    </div>
                </div>
                <div class="col-md-9">
                    <label class="form-label fw-bold small text-secondary text-uppercase tracking-wider">Diagnóstico</label>
                    <input type="text" name="diagnosis" class="form-control shadow-none border-secondary-subtle" 
                           placeholder="Descrição clínica do diagnóstico..." required>
                </div>

                <div class="col-12">
                    <label class="form-label fw-bold small text-primary text-uppercase tracking-wider">
                        <i class="bi bi-capsule-pill me-1"></i>Prescrição e Conduta
                    </label>
                    <textarea name="prescription" class="form-control border-primary shadow-none" 
                              rows="6" placeholder="Medicamentos, dosagem, frequência e orientações ao paciente..." required></textarea>
                </div>

                <div class="col-12">
                    <div class="form-check form-switch mb-2 p-0 d-flex align-items-center gap-5">
                        <label class="form-check-label small fw-bold text-secondary text-uppercase tracking-wider ms-4" for="needCertificate">
                            Emitir Atestado Médico
                        </label>
                        <input class="form-check-input ms-0" type="checkbox" id="needCertificate" 
                               onchange="document.getElementById('cert-area').classList.toggle('d-none')">
                    </div>
                    <div id="cert-area" class="d-none mt-3 p-3 bg-light rounded border border-dashed">
                        <label class="form-label fw-bold small text-dark">Texto do Atestado</label>
                        <textarea name="medical_certificate" class="form-control shadow-none bg-white" 
                                  rows="3" placeholder="Atesto para os devidos fins que o paciente necessita de..."></textarea>
                    </div>
                </div>
            </div>

            <hr class="my-4">

            <div class="d-flex justify-content-end gap-3">
                <button type="button" hx-get="/consultations" hx-target="#main-content" 
                        class="btn btn-outline-secondary px-4">
                    <i class="bi bi-pause-fill"></i> Pausar
                </button>
                <button type="submit" class="btn btn-success px-5 fw-bold shadow-sm">
                    <i class="bi bi-check2-all me-2"></i>Finalizar Atendimento
                </button>
            </div>
        </form>
    </div>
</div>