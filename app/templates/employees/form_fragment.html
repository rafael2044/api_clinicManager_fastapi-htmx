<div class="bg-white p-6 rounded-lg shadow-md border border-gray-100 max-w-4xl mx-auto">
    {% if success %}
        <div
            class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4">
            {{ success }}
        </div>
    {% endif %}
    {% if error %}
        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4">
            {{ error }}
        </div>
    {% endif %}
    <h2 class="text-xl font-bold mb-6 text-gray-800 border-b pb-2">
        {{ "Editar Funcionário" if employee else "Novo Funcionário" }}
    </h2>
    {% if not (employee and employee.id) %}
        <div class="flex bg-gray-100 p-1 rounded-lg mb-6 w-fit">
            <button type="button" 
                    hx-get="/employees/render-fields?role=doctor" 
                    hx-target="#dynamic-form-section"
                    class="nav-tab flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all bg-white text-blue-600 shadow-sm"
                    id="btn-doctor">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                Corpo Clínico (Médico)
            </button>
            <button type="button" 
                    hx-get="/employees/render-fields?role=admin" 
                    hx-target="#dynamic-form-section"
                    class="nav-tab flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all text-gray-500 hover:text-gray-700"
                    id="btn-admin">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                Administrativo / Outros
            </button>
        </div>
    {% endif %}

    <form 
        hx-post="{{'/employees/save?employee_id=' + (employee.id|string) if employee and employee.id else '/employees/save'}}"
        hx-target="#main-content" class="space-y-5">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Nome Completo</label>
            <input type="text" name="name" required value="{{ employee.name if employee else '' }}"
                   class="w-full rounded-md border-gray-300 border p-2 focus:ring-2 focus:ring-blue-500 outline-none">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">CPF</label>
                <input type="text" name="cpf" id="input-cpf" placeholder="000.000.000-00" required value="{{ employee.cpf if employee else '' }}"
                       class="w-full rounded-md border-gray-300 border p-2 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Data de Nascimento</label>
                <input type="date" name="birth_date" required value="{{ employee.birth_date if employee else '' }}"
                       class="w-full rounded-md border-gray-300 border p-2 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
        </div>

        <div id="dynamic-form-section">
            {% if employee %}
                {% if employee.role == "doctor" %}
                    {% include "employees/partials/fields_medical.html" %}
                {% else %}
                    {% include "employees/partials/fields_admin.html" %}
                {% endif %}
            {% else %}
                {% include "employees/partials/fields_medical.html" %}
            {% endif %}
        </div>

        <div class="flex justify-end gap-3 pt-4 border-t mt-4">
            <button type="button" hx-get="/employees" hx-target="#main-content" hx-push-url="true"
                    class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50">
                Cancelar
            </button>
            <button type="submit" id="submit-btn"
                    class="px-4 py-2 text-sm font-medium text-white rounded-md shadow-sm bg-blue-600 hover:bg-blue-700">
                {{ 'Salvar Funcionário' if employee and employee.id else 'Cadastrar Funcionário'}}
            </button>
        </div>
    </form>
</div>

<script>
    (function () {
        if (typeof IMask !== "undefined") {
            const inputCpf = document.getElementById("input-cpf");
            const maskCpf = {
                mask: "000.000.000-00",
            };
            IMask(inputCpf, maskCpf);
        }
    })();
    // Script simples para simular o comportamento de abas (estilo do botão)
    document.body.addEventListener('htmx:afterOnLoad', function(evt) {
        if (evt.detail.target.id === 'dynamic-form-section') {
            const isDoc = evt.detail.xhr.responseURL.includes('role=doctor');
            const btnDoc = document.getElementById('btn-doctor');
            const btnAdm = document.getElementById('btn-admin');
            const submitBtn = document.getElementById('submit-btn');

            if (isDoc) {
                btnDoc.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
                btnDoc.classList.remove('text-gray-500');
                btnAdm.classList.add('text-gray-500');
                btnAdm.classList.remove('bg-white', 'text-purple-600', 'shadow-sm');
                submitBtn.classList.replace('bg-purple-600', 'bg-blue-600');
            } else {
                btnAdm.classList.add('bg-white', 'text-purple-600', 'shadow-sm');
                btnAdm.classList.remove('text-gray-500');
                btnDoc.classList.add('text-gray-500');
                btnDoc.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                submitBtn.classList.replace('bg-blue-600', 'bg-purple-600');
            }
        }
    });
</script>