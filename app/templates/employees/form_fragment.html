<div class="container-fluid bg-white rounded shadow-sm border p-4 animate-fade-in">
    {% if success %}
        <div class="alert alert-success alert-dismissible fade show d-flex align-items-center" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>
            <div>{{ success }}</div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endif %}

    <h2 class="h4 fw-bold mb-4 text-dark border-bottom pb-2 d-flex align-items-center">
        <i class="bi {{ 'bi-pencil-square' if employee else 'bi-person-plus-fill' }} me-2 text-primary"></i>
        {{ "Editar Funcionário" if employee else "Novo Funcionário" }}
    </h2>

    {% if not (employee and employee.id) %}
        <div class="d-inline-flex bg-light p-1 rounded mb-4 shadow-sm border">
            <button type="button" 
                    hx-get="/employees/render-fields?role=doctor" 
                    hx-target="#dynamic-form-section"
                    class="btn btn-white shadow-sm d-flex align-items-center gap-2 text-primary fw-medium px-4 py-2"
                    id="btn-doctor">
                <i class="bi bi-hospital"></i>
                Corpo Clínico
            </button>
            <button type="button" 
                    hx-get="/employees/render-fields?role=admin" 
                    hx-target="#dynamic-form-section"
                    class="btn text-secondary d-flex align-items-center gap-2 px-4 py-2"
                    id="btn-admin">
                <i class="bi bi-briefcase"></i>
                Administrativo
            </button>
        </div>
    {% endif %}

    <form hx-post="{{'/employees/save?employee_id=' + (employee.id|string) if employee and employee.id else '/employees/save'}}"
          hx-target="#main-content" hx-push-url="/employees">
        
        <div class="mb-3">
            <label class="form-label fw-semibold text-secondary small">Nome Completo</label>
            <div class="input-group">
                <span class="input-group-text bg-white"><i class="bi bi-person text-muted"></i></span>
                <input type="text" name="name" required value="{{ employee.name if employee else '' }}" class="form-control">
            </div>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label class="form-label fw-semibold text-secondary small">CPF</label>
                <div class="input-group">
                    <span class="input-group-text bg-white"><i class="bi bi-card-text text-muted"></i></span>
                    <input type="text" name="cpf" id="input-cpf" placeholder="000.000.000-00" required 
                           value="{{ employee.cpf if employee else '' }}" class="form-control">
                </div>
            </div>
            <div class="col-md-6">
                <label class="form-label fw-semibold text-secondary small">Data de Nascimento</label>
                <div class="input-group">
                    <span class="input-group-text bg-white"><i class="bi bi-calendar-event text-muted"></i></span>
                    <input type="date" name="birth_date" required value="{{ employee.birth_date if employee else '' }}" class="form-control">
                </div>
            </div>
        </div>

        <div id="dynamic-form-section" class="p-3 rounded border border-secondary border-opacity-25 mb-4 shadow-sm">
            {% if employee %}
                {% if employee.role == "doctor" %}
                    {% include "employees/partials/fields_medical.html" %}
                {% else %}
                    {% include "employees/partials/fields_admin.html" %}
                {% endif %}
            {% else %}
                {% include "employees/partials/fields_medical.html" %}
            {% endif %}
        </div>

        <div class="d-flex justify-content-end gap-2 pt-3 border-top mt-4">
            <button type="button" hx-get="/employees" hx-target="#main-content" hx-push-url="true"
                    class="btn btn-light border px-4">
                Cancelar
            </button>
            <button type="submit" id="submit-btn" class="btn btn-primary px-4 d-flex align-items-center gap-2">
                <i class="bi bi-cloud-arrow-up"></i>
                {{ 'Salvar Alterações' if employee and employee.id else 'Cadastrar Funcionário'}}
            </button>
        </div>
    </form>
</div>

<script src="{{ url_for('static', path='js/form_employees.js') }}"></script>
